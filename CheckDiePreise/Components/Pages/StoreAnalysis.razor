@page "/analysis"

@using Radzen
@using Radzen.Blazor

<PageTitle>Supermarkt Analyse</PageTitle>
<MudPaper Class="pa-4 mb-4" Elevation="1">
    <MudText Typo="Typo.h4">Supermarkt Analyse</MudText>
    <MudDivider Class="my-4" />
    <MudText>
       Analysiere selbst die Webshops!
       <br/>
       Wähle einen WebShop aus und lass dir anzeigen, ob du die Preisentwicklungen nach Artikelpreis (z.B. 4,25€ pro Artikel) oder nach Grundpreis (z.b. 3,25€ pro Liter) angezeigt haben möchtest.
    </MudText>
</MudPaper>

<MudHidden Breakpoint="Breakpoint.Xs" Invert="true">
    <MudAlert Class="mt-4" Severity="Severity.Info">
        Diese Funktion steht Ihnen in der mobilen Ansicht aus Platz-Gründen nicht zur Verfügung.
        <br />
        Daten brauchen Platz - schauen Sie sich also alles lieber auf der Desktop-Version an :-)
        <MudIcon Icon="@Icons.Material.Filled.MobileOff"></MudIcon>
    </MudAlert>
</MudHidden>

<MudHidden Breakpoint="Breakpoint.Xs" Invert="false">
 
    <MudGrid>
        <MudItem xs="12">
            <MudText Typo="Typo.caption">Bitte wähle einen WebShop aus:</MudText>
            <br/>
            <MudButtonGroup Color="Color.Secondary" Variant="MudBlazor.Variant.Filled" Class="mb-4" Style="flex-wrap: wrap;">

                @foreach (var store in _availableStores)
                {
                    <MudButton OnClick='() =>DrawChart(store)'>@store</MudButton>
                }
            </MudButtonGroup>

            <br />
            <br/>
            <MudText Typo="Typo.caption">Bitte wähle aus, ob du die Preisentwicklungen nach Artikelpreis (z.B. 4,25€ pro Artikel) oder nach Grundpreis (z.b. 3,25€ pro Liter) angezeigt haben möchtest:</MudText>
            <br/>
            <MudButtonGroup Color="Color.Tertiary" Variant="MudBlazor.Variant.Filled">
                <MudButton OnClick='() =>SetPrice(true)'>Artikelpreis</MudButton>
                <MudButton OnClick='() =>SetPrice(false)'>Grundpreis</MudButton>
            </MudButtonGroup>

            </MudItem>

        @if (string.IsNullOrEmpty(_store))
        {
            <MudItem xs="12">
                <MudText Align="Align.Center" Typo="Typo.h6">Bitte wählen sie einen Supermarkt aus.</MudText>
            </MudItem>
        }
        else
        {
            <MudItem xs="12">
                @if (_displayUnit)
                {
                    <MudText Align="Align.Center" Typo="Typo.h6">Supermarkt-Daten für @_store in Preis/Stk</MudText>
                }
                else
                {
                    <MudText Align="Align.Center" Typo="Typo.h6">Supermarkt-Daten für @_store in Preis/Einheit</MudText>
                }

            </MudItem>
        }


        <MudItem xs="12" Style="min-height: 45vh;">

            @if (_showSpinner)
            {
                <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
            }
            else
            {
                @if (_chartData.Count > 0)
                    {
                        <RadzenChart ColorScheme=ColorScheme.Palette>

                            @foreach (var category in _chartData)
                            {
                                <RadzenLineSeries Interpolation="Interpolation.Step" Data="@category.Value" CategoryProperty="Date" Title=@category.Key LineType="LineType.Solid" StrokeWidth="4" ValueProperty="Price">
                                    <RadzenMarkers Visible="true" MarkerType="MarkerType.Square" />
                                    <RadzenSeriesDataLabels Visible="false" />
                                </RadzenLineSeries>
                            }


                            <RadzenCategoryAxis Padding="20" />
                            <RadzenValueAxis Min="0" Formatter="@FormatAsDouble">
                                <RadzenGridLines Visible="true" />

                                @if (_displayUnit)
                                {
                                    <RadzenAxisTitle Text="Preis in €/Stk" />
                                }
                                else
                                {
                                    <RadzenAxisTitle Text="Preis in €/Einheit" />
                                }


                            </RadzenValueAxis>
                        </RadzenChart>
                    }
            }
        </MudItem>
        </MudGrid>
    <MudText Typo="Typo.caption">(Ein Klick auf eine Kategorie in der Legende blendet diese ein oder aus.)</MudText>
</MudHidden>


