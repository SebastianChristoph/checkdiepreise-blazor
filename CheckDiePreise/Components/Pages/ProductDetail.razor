@page "/product/{store}/{name}-{identifier}"

@using Radzen
@using Radzen.Blazor

<PageTitle>Produkt-Detail</PageTitle>

<MudGrid Class="mb-2">
    <MudItem xs="12">
        <MudText Class="mb-4" Typo="Typo.h4">Produktdetails</MudText>
        <MudText Color="MudBlazor.Color.Secondary" Typo="Typo.caption">@Store, Artikelnummer: @Identifier</MudText>
        <MudText Typo="Typo.h6">@Name</MudText>
    </MudItem>
</MudGrid>

@if(_productChanges is not null)
{
    <MudButton Variant="MudBlazor.Variant.Filled" Color="Color.Secondary" Href="@_productChanges[0].Url" Target="_blank" Class="mb-8">Zum Produkt im @Store-WebShop</MudButton>
      <RadzenChart>
        <RadzenLineSeries Interpolation="Interpolation.Step" Data="@_chartData" CategoryProperty="Date" Title=@Name LineType="LineType.Solid" StrokeWidth="5" Stroke="#E08148" ValueProperty="Price">
            <RadzenMarkers Visible="true" MarkerType="MarkerType.Square" />
            <RadzenSeriesDataLabels Visible="true" />
        </RadzenLineSeries>

        <RadzenLineSeries Interpolation="Interpolation.Step" Data="@_chartDataBaseprice" CategoryProperty="Date" Title=@($"{Name} Grundpreis") LineType="LineType.Solid" StrokeWidth="5" Stroke="#62ABFF" ValueProperty="Price">
            <RadzenMarkers Visible="true" MarkerType="MarkerType.Square" />
            <RadzenSeriesDataLabels Visible="true" />
        </RadzenLineSeries>

        <RadzenCategoryAxis Padding="20" />
        <RadzenValueAxis Min="0">
            <RadzenGridLines Visible="true" />
            <RadzenAxisTitle Text="Preis in €" />
        </RadzenValueAxis>
    </RadzenChart>

    <MudText Typo="Typo.caption">(Ein Klick auf das Produkt in der Legende blendet dieses ein oder aus.)</MudText>

    @if(_productChanges.Count < 2)
    {
        <MudAlert Severity="Severity.Info">Für dieses Produkt wurden bisher keine Preis-Änderungen erfasst. Der unten angezeigte Preis ist der erstmals erfasste Preis aus dem WebShop.</MudAlert>
    }

    <MudSimpleTable Class="mt-8" Dense="true" Hover="true" Striped="true" Style="overflow-x: auto;">
        <thead>
            <tr>
               <th><strong>Preisänderung</strong></th>
                <th><strong>Preis pro Stk.</strong></th>
                <th><strong>Preis pro Einheit</strong></th>
                <th><strong>Trend</strong></th>
            </tr>
        </thead>
        <tbody>
                @foreach (var productChange in _productChanges)
            {
                <tr>
                    <td>@productChange.Date.ToString("dd/MM/yyyy")</td>
                    <td>@productChange.Price.ToString("N2")€ / Stk</td>
                    <td>@productChange.Baseprice.ToString("N2")€ / @productChange.BasepriceUnit</td>
                   <td>

                            @if (productChange.Trend == "up")
                            {
                                <span style="color:red;"> <MudIcon Icon="@Icons.Material.Filled.TrendingUp" class="mr-3"></MudIcon></span>
                            }
                            else if (productChange.Trend == "down")
                            {
                                <span style="color:green;"> <MudIcon Icon="@Icons.Material.Filled.TrendingDown" class="mr-3"></MudIcon></span>
                            }
                            else
                            {
                                <span style="color:gray;"> <MudIcon Icon="@Icons.Material.Filled.TrendingFlat" class="mr-3"></MudIcon></span>
                                ;
                            }

                   </td>
                </tr>
            }
        </tbody>
</MudSimpleTable>
}


